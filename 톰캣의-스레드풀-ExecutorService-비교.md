### **톰캣의 스레드 관리 방식**

1. **자체 구현된 `ThreadPoolExecutor` 사용**:
    - 톰캣은 **Apache Commons Executor** 라이브러리의 **`ThreadPoolExecutor`*를 기반으로 스레드를 관리합니다
    - 이 구현은 Java의 표준 `ThreadPoolExecutor`를 확장한 형태로, 고성능을 위해 커스터마이징되어 있습니다
2. **커스터마이징 가능**
    - 개발자는 톰캣의 설정 파일(`server.xml`)에서 스레드 풀 관련 속성을 조정하여 원하는 동작을 설정할 수 있습니다
        - 예: **최대 스레드 수**, **스레드 대기 시간**, **큐 크기** 등을 변경
    - 설정 예시

        ```xml
        <Connector port="8080" protocol="HTTP/1.1"
                   connectionTimeout="20000"
                   redirectPort="8443"
                   maxThreads="200"
                   minSpareThreads="25"
                   acceptCount="100" />
        
        ```

        - `maxThreads`: 최대 스레드 수
        - `minSpareThreads`: 항상 대기 중인 최소 스레드 수
        - `acceptCount`: 대기열에 허용되는 최대 요청 수
3. **`ThreadPoolExecutor`의 주요 특징**:
    - 동적으로 스레드를 생성하거나 제거
    - 스레드가 유휴 상태로 오래 유지되면 스레드를 종료
    - 스레드가 부족한 경우, 대기열에 요청을 추가
    - 스레드가 초과되거나 대기열이 넘칠 경우, 적절한 예외를 던지거나 요청을 거부


### **왜 톰캣은 `ExecutorService`를 사용하지 않나?**

톰캣은 범용적인 애플리케이션이 아니라 고성능 서버 환경에 최적화되어야 합니다. 아래와 같은 이유로 톰캣은 자체 구현을 사용합니다

1. **고성능 요구**
    - 웹 서버는 수천~수만 개의 동시 요청을 처리해야 하므로, 메모리 관리와 스레드 효율성을 극대화해야 합니다
    - Java의 `ExecutorService`는 범용적으로 설계되었으나, 톰캣은 특정 워크로드와 네트워크 트래픽에 맞게 조정이 필요합니다
2. **정밀한 커스터마이징**
    - 톰캣의 `ThreadPoolExecutor`는 대기열 관리, 작업 거부 정책, 스레드 종료 조건 등을 세부적으로 커스터마이징할 수 있습니다
    - 서버 관리자나 개발자는 설정 파일에서 이를 쉽게 조정 가능합니다
3. **I/O 작업과의 통합**
    - 톰캣의 스레드 풀은 단순한 작업 실행뿐만 아니라 **I/O 처리, 요청 수락, 응답 작성** 등과 깊이 통합되어 있습니다
    - `ExecutorService`는 이와 같은 깊은 통합을 지원하지 않습니다


### **톰캣과 Java `ExecutorService` 비교**

| **특징** | **톰캣의 스레드 관리** | **`ExecutorService`** |
| --- | --- | --- |
| **커스터마이징** | 설정 파일로 세밀한 조정 가능 | 제한적 (풀 크기, 큐 타입 등) |
| **대기열 관리** | 대기열 크기 및 동작 직접 설정 가능 | 내부적으로 관리됨 |
| **동작 방식** | 서버 워크로드에 맞게 최적화 | 범용적인 스레드 풀 구현 |
| **성능 최적화** | 고성능 서버 환경에 맞춤 | 일반적인 애플리케이션용으로 설계됨 |
| **확장성** | 수천 개의 요청 처리에 최적화 | 수십~수백 개 요청 처리에 적합 |

